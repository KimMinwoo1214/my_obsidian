---
tags:
  - AI
  - PointCloud
  - SLAM
  - CV
aliases: 
type: lecture-note
created: 2024-07-23
reviewed: false
notices: false
summary: false
---
### **Subject**:: [[3D Point Cloud Data Processing]]
### **Week**:: 2

**이전 강의 노트**: [[1. 3D Point Cloud]]

### 강의자료: 
[[3D Data Acquisition (Passive).pdf]]

# 강의필기 (Lecture Notes)
<br>

## [[Camera]] [[Matrix]]

1. **카메라 매트릭스**:
    - 3D 포인트를 2D 이미지 포인트로 매핑하는 수학적 표현.
    *A mpping from 3D world to 2D image*
    $$
	\mathbf{x} = \mathbf{P} \mathbf{X}
	$$
	**2D image point**
	**Camera matrix**
	**3D world point**
	<br>
	
    - 호모지니어스 좌표로 표현된 3D 및 2D 포인트를 사용.
    *Generic camera*
    $$
	\begin{bmatrix}
	x \\
	y \\
	z \\
	\end{bmatrix}
	=
	\begin{bmatrix}
	p_1 & p_2 & p_3 & p_4 \\
	p_5 & p_6 & p_7 & p_8 \\
	p_9 & p_{10} & p_{11} & p_{12}
	\end{bmatrix}
	\begin{bmatrix}
	X \\
	Y \\
	Z \\
	1
	\end{bmatrix}
	$$
	*homogeneous image* \( 3 x 1 \)
	*Camera matrix* \( 3 x 4 \)
	*homogeneous world point* \(4 x 1\)
    - 트리바이4 (3x4) 매트릭스로 구성되어 있으며, 11개의 자유도(DOF)를 가집니다.
    - 핀홀 카메라 모델을 주로 사용하며, 이 모델에서는 포컬 렌스와 카메라 센터 간의 거리를 고려합니다.
    ![[pinhole_image.png]]
    *Pinhole camera*
	$$
	\begin{bmatrix}
	x \\
	y \\
	z \\
	\end{bmatrix}
	=
	\begin{bmatrix}
	f & 0 & 0 & 0 \\
	0 & f & 0 & 0 \\
	0 & 0 & 1 & 0 \\
	\end{bmatrix}
	\begin{bmatrix}
	X \\
	Y \\
	Z \\
	1
	\end{bmatrix}
	$$
	**homogeneous image** \( 3 x 1 \)
	**Camera matrix** \( 3 x 4 \)
	**homogeneous world point** \(4 x 1\)
	![[account_for_image_origin.png]]
	*Accounts for image origin*
    $$
    \begin{bmatrix}
	x \\
	y \\
	z \\
	\end{bmatrix}
	=
	\begin{bmatrix}
	f & 0 & p_x & 0 \\
	0 & f & p_y & 0 \\
	0 & 0 & 1 & 0 \\
	\end{bmatrix}
	\begin{bmatrix}
	X \\
	Y \\
	Z \\
	1
	\end{bmatrix}
    $$
    **homogeneous image** \( 3 x 1 \)
	**Camera matrix** \(3 x 4 \)
	**(3 x 4)**
	**homogeneous world point** \(4 x 1\)
    - 매트릭스는 월드 원점과 이미지 원점을 반영하도록 디컴포즈할 수 있습니다.
    *Decomposed P*
    $$
    \begin{bmatrix}
	x \\
	y \\
	z \\
	\end{bmatrix}
	=
	\begin{bmatrix}
	f & 0 & p_x & 0 \\
	0 & f & p_y & 0 \\
	0 & 0 & 1 & 0 \\
	\end{bmatrix}
	\begin{bmatrix}
	1 & 0 & 0 | 0 \\
	0 & 1 & 0 | 0 \\
	0 & 0 & 1 | 0 \\
	\end{bmatrix}
	\begin{bmatrix}
	X \\
	Y \\
	Z \\
	1
	\end{bmatrix}
    $$
    **homogeneous image** \( 3 x 1 \)
	**\( 3 x 3\)**
	**homogeneous world point** \(4 x 1\)
	$$
    P = K[I|0]
    $$
    <br>
    
	![[account_for_world_origin.png]]
    *Accounts for world origin*    
    $$
    \begin{bmatrix}
	x \\
	y \\
	z \\
	\end{bmatrix}
	=
	\begin{bmatrix}
	f & 0 & p_x & 0 \\
	0 & f & p_y & 0 \\
	0 & 0 & 1 & 0 \\
	\end{bmatrix}
	\begin{bmatrix}
	r_1 & r_2 & r_3 | t_1 \\
	r_4 & r_5 & r_6 | t_2 \\
	r_7 & r_8 & r_9 | t_3 \\
	\end{bmatrix}
	\begin{bmatrix}
	X \\
	Y \\
	Z \\
	1
	\end{bmatrix}
    $$
    **homogeneous image** \( 3 x 1 \)
	**intrinsic parameters**
	**extrinsic parameters**
	**homogeneous world point** \(4 x 1\)
    $$
    P = K[R|t]
    $$
    

## [[Camera]] [[Calibration]]

1. **카메라 캘리브레이션**:
	- Conic이란 평면에서 이차 방정식으로 설명되는 곡선이다. 
	$$
	ax^2 + bxy + cy^2 + dx + ey + f = 0 \text{ //inhomogeneous}
	$$
	$$
	ax_1^2 + bx_1x_2 + cx_2^2 + dx_1x_3 + ex_2x_3 + fx_3^2 = 0 \text{ //homogeneous}
	$$
	$$
	x^TCx = 0, 
	C = \begin{bmatrix}
	a & b/2 & d/2 \\
	b/2 & c & e/2 \\
	d/2 & e/2 & f \\
	\end{bmatrix} \text{ //homogeneous, matrix}
	$$
    - 카메라 매개변수를 추정하는 과정으로, 주로 절대 원추(IAC)를 사용합니다.
    $$
	\text{Mapping from plane at infinity } (\Pi_{\infty}) \text{ to image plane: } H = KR
	$$
    $$
    \text{Conic maps: } C -> H^-TCH^-1
    $$
    $$
    \text{Absolute Conic maps: } I -> (KR)^-TI(KR)^-1 = (KK^T)^-1 = w
    $$
    - IAC는 실제 포인트가 없는 수학적 도구로, 이미지 상의 컴포넌트(VP, VL 등)를 제약하는 데 사용됩니다.
    - 캘리브레이션은 주로 [[SVD]]와 같은 선형 대수 기법을 사용하여 수행됩니다.
    $$
    \text{Cholesky decomposition on DIAC:  } w^* = w^-1 = KK^T
    $$

## Questions in [[Geometry]] [[Vision]]

1. **Pose Estimation**:
    
    - 3D-2D 대응 관계를 사용하여 카메라의 위치와 방향을 추정.
    $$
    {X_i, x_i} -> P \text{ X in {world}, x in {image}}
    $$
    - N개의 3D 점과 2D 점의 대응 관계를 사용하여 [[Projection]] 변환을 설명합니다.
    $$
    \begin{bmatrix}
    X_1^T & 0 & -x'X_1^T \\
    0 & X_1^T & -y'X_1^T \\
    \vdots & \vdots & \vdots \\
    X_N^T & 0 & -x'X_N^T \\
    0 & X_N^T & -y'X_N^T \\
    \end{bmatrix} 
    \begin{bmatrix}
    p_1 \\ 
    p_2 \\ 
    p_3 \\
    \end{bmatrix}
    = 0
    $$
    - [[SVD]]를 사용하여 카메라 센터와 인트린직 파라미터, 로테이션을 추정합니다.
	$$
	P \text{ -> } K[R|-Rc] \text{  or  } [M|-Mc]
    $$
    $$
    Pc = 0 \text{ , }M = KR 
    $$
    $$
    \text{ SVD, (RQ(ambiguity))}
    $$
    
1. **Triangulation**:
    
    - 2D-2D 대응 관계와 카메라 모션을 사용하여 3D 구조를 추정.
    $$
    {x_i, x_i'} \text{ and } P,P' \text{ -> } X
    $$
    - DLT(직접 선형 변환)와 SVD를 사용하여 근사 값을 구합니다.
    $$
    x = {alpha}PX \text{ and } x * PX = 0 \text{ -> }
    \begin{bmatrix}
    yp_3^T - p_2^T \\
    p_1^T - xp_3^T \\
    y'p_3'^T - p_2'^T \\
    p_1'^T - x'p_3'^T \\
    \end{bmatrix}
    X = \begin{bmatrix}
    0 \\
    0 \\
    0 \\
    0 \\
    \end{bmatrix}
    $$
    $$
    AX = 0
    $$
    $$
    \text{SVD}
    $$
1. **Reconstruction**:
    
    - 2D-2D 대응 관계를 통해 3D 구조와 모션을 동시에 추정.
    $$
    {x_i, x_i'} \text{ -> } X \text{ }P,P'
    $$
    - Steps
		$$
	    1. \text{Compute F from} {x, x'} \text{ // 8-point algorithm (*Fundamental Matrix*)}
	    $$
	    $$
	    2. \text{Compute P, P' from F}
	    $$
	    $$
		3. \text{Compute } X_i \text{ from P,P' and } {x_i, x_i'} \text{ // DLT(Triangulation)}
	    $$
	    $$
	    P = [I|0] \text{ and } P' = [[e_x]F|e']
	    $$
    - 펀더멘탈 매트릭스를 계산하고 이를 통해 카메라 매트릭스와 3D 포인트를 계산합니다.
    ![[Reconstruction_Ambiguity.png]]
    ![[Reconstruction_Projective.png]]
    ![[Projective_Affine.png]]
    ![[Affine_Euclidean.png]]

## [[Epipolar]] [[Geometry]], E, F
![[Epipolar.png]]

1. **에피폴라 기하학**:
    - 두 이미지 간의 점 대응 관계를 설명.
    - 에피폴(소실점), 에피폴라 라인(소실선), 에피폴라 평면 등을 포함.
    - [[Epipole]]: 한 카메라의 중심이 다른 카메라의 이미지 평면에 투영된 점
    - [[Epipolar Line]]: 한 이미지의 특정 점을 지나는 선이며, 다른 이미지에서 해당 점이 위치할 수 있는 가능한 모든 위치를 나타낸다.
    - [[Epipolar Plane]]: 두 카메라의 중심과 특정 3D 포인트를 포함하는 평면
    - 에센셜 매트릭스(E)와 펀더멘탈 매트릭스(F)를 사용하여 이러한 관계를 수학적으로 표현합니다.
    *Essential Matrix* (Algebraic representation of epipolar geometry (3x3 matrix))
    $$
    (x')^TEx = 0 \text{ (calivrated camera points)} \text{ and } Ex = l' \text{ }(E = R[t_x])
    $$
    *Fundamental Matrix* (Generalization of E for **uncalibrated** cameras)
    $$
    (x')^TFx =0 \text{ (plain image points)} \text{ and } Fx = l' \text{  }(F = K'^{-T}EK^-1)
    $$
    $$
    \begin{bmatrix}
    x_m' & y_m' & 1 \\
    \end{bmatrix}
    \begin{bmatrix}
    f_1 & f_2 & f_3 \\
    f_4 & f_5 & f_6 \\
    f_7 & f_8 & f_9 \\
    \end{bmatrix}
    \begin{bmatrix}
    x_m & y_m & 1 \\
    \end{bmatrix}
    = 0
    $$
    8-point algorithm
    $$
    \begin{bmatrix}
    x_1X_1' & x_1y_1' & x_1 & y_1x_1' & y_1y_1' & y_1 & x_1' & y_1' & 1 \\
    \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
    x_Mx_M' & x_My_M' & x_M & y_Mx_M' & y_My_M' & y_M & x_M' & y_M' & 1 \\
    \end{bmatrix}
	\begin{bmatrix}
	f_1 \\
	f_2 \\
	f_3 \\
	f_4 \\
	f_5 \\
	f_6 \\
	f_7 \\
	f_8 \\
	f_9 \\
	\end{bmatrix}
	= 0
    $$
    $$
    \text{SVD}
    $$
    *Solve for e,e'*
    $$
    Fe = 0
    $$
    $$
    \text{ SVD}
    $$

## [[Photogrammetry]]

- 포토그래매트리는 사진 이미지와 전자기파 이미지를 통해 물리적 객체와 환경에 대한 정보를 얻는 과학 및 기술입니다.
- 2D 데이터에서 3D 측정값을 추출하거나 정확한 색상 범위 및 값을 추출합니다.

## [[Stereo]] [[Vision]]

- **단계**
	1.이미지 정렬
	2. 각 픽셀에 대해 수행
		a. Find epipolar line
		b. Find the best match along the line
		c. Compute depth from disparity
	
1. **스테레오 정합 (Stereo Rectification)**:
	![[Stereo_vision_rectification.png]]
    - 이미지를 동일한 평면으로 정렬하여 에피폴라 라인이 수평이 되도록 만듭니다.
    - 두 3x3 호모그래피 행렬 H1, H2를 사용하여 이를 수행합니다.
2. **베스트 매치 찾기 (Find the best match)**:
	![[Best_match.png]]
	- 왼쪽 이미지의 특정 픽셀 (x, y)와 오른쪽 이미지의 같은 y 좌표를 갖는 모든 x' 픽셀을 비교합니다. 
	- SSD, SAD, NCC와 같은 방법을 사용하여 가장 잘 맞는 점을 찾습니다.
3. **깊이 추정 (Depth Estimation)**:
	![[Disparity.png]]
	![[Depth_estimation.png]]
    - 각 픽셀에 대해 에피폴라 라인을 찾고, 가장 잘 맞는 대응점을 찾아 깊이를 계산합니다.
    - 매칭의 유일성, 포인트 순서, 깊이 부드러움 등을 통해 깊이 추정을 개선합니다.

## N-view [[Reconstruction]]

1. **다중 뷰 재구성**:
    - 여러 뷰에서의 재구성은 카메라가 보정되었는지, K 매개변수에 대한 제약이 있는지에 따라 달라집니다.
    ![[Projective_ambiguity.png]]
    $$
    \mathbf{p_{ij}} = \mathbf{M_i}\mathbf{P_j} \quad \text{//Different notations...}
    $$
    - 프로젝티브 재구성에서 시작하여 어파인 및 유클리드 재구성으로 이어집니다.
    - 트라이포컬 텐서 및 쿼드리포컬 텐서를 사용하여 여러 뷰의 대응 관계를 정의합니다.
    - 번들 조정 및 스파스 매트릭스 기법을 사용하여 최적의 재구성을 수행합니다.
## 공지사항
<br>



## 수업 내용


# 다음 할 일(After Actions)
## 작업 (Tasks)


## 정리 (Summary)



