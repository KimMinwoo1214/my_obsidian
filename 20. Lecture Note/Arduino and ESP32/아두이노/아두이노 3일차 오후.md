# 아두이노 3일차 오후

모터 제어

모션을 인식 시킬 때 원래는 동역학적으로 해야하나, 그것을 어려움으로, 사람이 직접 조종하는 것의 모션을 인식해서 그대로 따라하게 한다. 즉 한계 무게 정도만 설계하고 나머지는 계속 교육만 시키면  동역학 없이 할 수 있다.

모터의 종류

[https://blog.naver.com/motor2662/223423534838](https://blog.naver.com/motor2662/223423534838)

[https://blog.naver.com/samjinfa/222534775206](https://blog.naver.com/samjinfa/222534775206)

![Untitled](Untitled%2029.png)

# **DC 모터**

- **고정자를 영구자석으로 사용**하고 **회전자(전기자)를 코일로 사용하여 구성한 것**으로 전기자에 흐르는 전류의 방향을 전환함으로써 자력의 반발, 흡인력으로 회전력을 생성시키는 모터입니다.
- **DC 모터는 제어용 모터로써 매우 우수한 특성**을 가지고 있는데요.
- 급격한 가속성, 큰 시동 토크 등 대부분 제어용 모터에 요구되는 모든 성능을 겸비한 우수한 모터입니다.
- DC모터의 구조는 크게 Rotor(로터, 전기자), 계자용 마그넷, 브러시, 베어링 모터케이스 등으로 이루어져 있습니다.
- 전기자는 회전력을 발생하고 모터의 회전체를 구성하며, 베어링은 로터의 회전구조를 형성하는 것인데 볼 베어링이나 오일리스 메탈이 사용되고 있습니다. 계좌용 마그넷은 전기자 권선에 자력을 주는 것이며 전기자에서 발생하는 전자기력과 함께 회전력을 발생시킵니다.

# **AC모터**

- **AC 모터는 동기기형(synchronous Type) 과 유도기기형(Induction Type) 으로** 나뉘는데 동기기형은 DC모터와 반대로 자석이 회전자에 부착되어 있고, 전기자 권선은 고정자축에 감기는 구조로 이루어져 있는데 이 구조는 BLDC 모터와동일합니다. 회전자의 영구자석이 있는 형태로 구조가 다소 복잡하고, 제어 시 회전자의 위치를 검출합니다.
- 유동기형은 고정자측에 프레임과 고정자 코어, 전지가 권선에 있고 회전자는 샤프트, 회전자 코어 그리고 코어의 외경에 도전체가 조립된 구조를 이루고 있습니다.
- 사용 전원 주파수에 의해 속도가 정해지며 **구조가 견고하고 취급이 쉽다는 장점과 기동 토크가 작아 적은힘으로도 구도잉 가능하다는 특징**을 가지고 있습니다.

# **Step 모터**

- **스텝모터는 스테핑모터 또는 펄스모터라고도 하며 펄스에 의한 제어로 일정한 각도의 회전이 쉬운 모터**입니다.
- Step 은 단계적으로 움직이는 것을 의미하는데 스텝모터의 특징을 잘 표현해주고 있습니다.
- **스텝모터는 모터의 회전 각도가 입력하는 펄스 신호에 정확히 일치되기 때문에 정확한 각도제어가 가능하고, 고유의**
- **분할 각도가 존재하며 이 분할 각도를 이용하여 회전각도를 제어**하게 됩니다.
- 스텝모터는 디지털 신호로 제어하므로 컴퓨터로 사용하기 쉽고, 특정 주파수에서 진동,공진이 발하기 쉽습니다.
- 다만, 관성이 있는 부하에는 약하고, 고속 운전 시 탈조 발생이 쉽습니다.

# **BLDC 모터**

- **BLDC(Brshless Motor) 는 DC모터에서 브러시와 정류자(Commutatot)를 제거하고 전자적인 정류 기구를 설치한 모터**입니다. **BLDC모터의 작동원리는 DC모터와 같이 플레밍의 왼손 법칙으로 설명할 수 있으며 코일 또는 영구 자석의 어느 쪽이 회전해도 그 작동 원리는 같으나, BLDC 모터에는 정류자가 없기 때문에 이것을 대신하는 전자 정류 회로가 따로 필요**합니다.
- 전자 정류 회로는 홀 소자 등의 자극 센서를 사용하며 마그넷 로터가 어느 위치에 있는가를 검지하고, 이 신호를 기초로 전자 회로를 제어하여 회전 자기장을 발생시킵니다. 이것이 BLDC의 구동회로인데 회로구성이 매우 복잡하게 되어 있기 때문에 보통 전용IC가 사용됩니다.
- 구동 방식상 3상 유도 전동기의 특성과 유사하여, 저속 고속에서 토크가 비교적 높고 고속 회전도 가능하며 무접점의 반도체 소자로 코일의 전류를 드라이브 하는 관계입니다.
- **수명이 매우 길고 소음과 전자적인 잡음을 거의 발생시키지 않으며 모터 드라이브 회로 자체에서 직접 속도조절을 할 수 있는 장점**이 있습니다.
- 단점으로는 회전자에 영구자석을 사용하는 것으로서 완전 무접점의 모터를 실현하기 위한 것으로는 영구자석의 한계로 대용량의 모터 제작이 불가능하다는 단점을 가지고 있습니다.

모터 실습.

우리가 연결한 GRN과 5V는 AMS177에 연결 된다.

```arduino
int A_IA = 10;   
int A_IB = 9;

void setup() {
  Serial.begin(115200);
  pinMode(A_IA,OUTPUT);
  pinMode(A_IB,OUTPUT);
}

void loop() {
  if (Serial.available()>0) {                // 시리얼 모니터에서 무언갈 입력한다.
    char c = Serial.read();
    if(c=='f'){
      analogWrite(A_IA,128);
      analogWrite(A_IB,0);
    }
    else if(c=='b'){
      analogWrite(A_IA,0);
      analogWrite(A_IB,128);
    }
    else if(c=='s'){
      analogWrite(A_IA,0);
      analogWrite(A_IB,0);
    }
  }
}
```

![7.jpg](7.jpg)

f를 누르면 정방향 회전

b를 누르면 역방향 회전

s를 누르면 정지

보통 모터에는 전압한계와 전류한계가 있다. 이걸 잘 맞춰야 장비가 손상되지 않고 잘 굴러간다.

그래서 우리는 레귤레이터를 사용해서 전압을 조정한다.

보통 모터나 센서를 잘못 설정할 경우 모터가 돌아가는 순간 모터는 5V이고 라즈베리파이는 3.3V이므로 터져버린다.

ch340이라는 것이 우노에 달려있는 USB단자 이다.

다음 버튼을 한번 누를 때마다 회전수를 늘리는 것을 코딩해보자!

```arduino
const int buttonPin = 2;    
const int A_IA = 10;
const int A_IB = 9;

int DCspeed = 0;
int buttonState = HIGH;  
int lastButtonState = HIGH;  

unsigned long lastDebounceTime = 0;     // 디바운스 타이머
unsigned long debounceDelay = 50;       // 디바운스 지연 시간// 이시간을 기준으로 float상태를 구분

void motor(int data){
  analogWrite(A_IA,0);
  analogWrite(A_IB,data);       // data == 모터의 속도
}

void setup() {
  pinMode(A_IA,OUTPUT);
  pinMode(A_IB,OUTPUT);
  pinMode(buttonPin,INPUT_PULLUP);
  analogWrite(A_IA,0);
  analogWrite(A_IB,0);
  Serial.begin(115200);
}

void loop(){
  int reading = digitalRead(buttonPin);   //  버튼의 상태를 읽음  - 만약 버튼을 누르면 reading이 0이 된다
  if (reading != lastButtonState) {       // 버튼을 누르면 여기 안들어가고 lastDebounceTime이 갱신되지 않는다. 즉 아래에 있는 debounceDelay와의 비교를 의미있게 만든다.
    lastDebounceTime = millis();         // 디바운스 타이머 업데이트
  }
  if ((millis() - lastDebounceTime) > debounceDelay) {   // 여기서 millis()함수는 코드가 실행된 이후로 계속 시간을 측정하는 함수이다. 그래서 여기서 버튼을 누르는 것의 delay를 비교하여 실행한다.
    if (reading != buttonState) {        // 원래 buttonState는 1이였다가 reading은 버튼이 눌림에 따라 1이 되므로 if문에 들어간다.
      buttonState = reading;
      Serial.println(reading);       // 평소에 1누르면 0이다.
      Serial.println(buttonState);   // 평소에 1누르면 0이다.
      if (buttonState == LOW) {        // PULL UP이랑 같은 방식이다. //////왜?/////
        DCspeed += 120;
        if(DCspeed >=300){      // 만약 속도가 300 이상이면 0으로 변경
          DCspeed=0;
        }
        Serial.println(DCspeed);         // 속도 출력
      }
    }
  }
  lastButtonState = reading;   // 마지막 버튼상태 업데이트
  motor(DCspeed);             // 모터의 속도 설정
}
```

코드의 이해가 좀 오래걸렸다.

모터란?

모터의 종류

- DC모터
- 서보모터
- 스태핑모터
- BLDC모터

모터는 중간에 쇳덩이가 있으며 주변에는 코일이 있다. 여기에 감겨있는 전류가 +-로 변함에 따라 마치 회전하는 것 처럼 보인다. 이걸로 모터를 회전하는 것과 같은 원리 이다.

이걸 펴보면 자기부상열차와 같다.

에스컬레이터 중에 사람이 앞에 가면 움직이는 에스컬레이터의 경우, 속도를 어떻게 빠르게 할까? 

발전소에서 60HZ로 받은 전기를 정류로 비꾸었다가 인버터를 이용하여 직류를 더빠른 교류로 한번 더 바꾸어 준다.

BLDC 모터는 정류로 한번 만드는 과정을 건너 뛰고 직류로 받은 것을 인버터로 바로 활용하는 것이다.

보통 BLDC를 많이 사용한다. 하지만 비싸다.

나중에 로봇암을 만들 때 엔코더를 이용해서 로봇암의 그립 범위를 지정해 버려서 감압 센서 같은 비용을 줄인다. 그냥 지정된 범위까지 줄이는 것을 목표로 해서 만들면 된다.

모터 전원에서 공통접지를 만드는 이유

나중에 브레드 보드의 양쪽을 모두 사용할 때 모든 부분의 전압을 같게 만들어 주어야 하므로 연결한다.