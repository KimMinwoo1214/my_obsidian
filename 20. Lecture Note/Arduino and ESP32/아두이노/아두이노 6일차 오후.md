# 아두이노 6일차 오후

우리는 소켓에서 4,7번째 를 많이 공부한다

4번쨰는 인터넷과 통신하는 것

파이썬과 이 서버 소캣이고 클라이언트 소캣이 아두이노 이다.

```arduino
#include <WiFi.h>

#define ssid  "ConnectValue_A401_2G"
#define password   "CVA401!@#$"

void setup() {
    Serial.begin(115200);
    WiFi.begin(ssid, password);               //Serial begine와 같다.
    while (WiFi.status() != WL_CONNECTED) {   // 연결 되지 않으면 '.'출력
        delay(500);
        Serial.println(".");
    }
    Serial.print("WiFi connected with IP:");  // 연결되면 While문에서 나옴, 그리고 IP번호를 받음
    Serial.println(WiFi.localIP());           // 자기가 wifi번호를 IP번호를 출력
}

void loop() {
    WiFiClient client;                                      // 이런 이름의 객체를 만
    if(!client.connect(IPAddress(172,30,1,51), 10000)){     // 여기에 ip주소를 넣으면됨          
    // if (!client.connect("192.168.1.68", 10000)) {          
        Serial.println("Connection to host failed");
        delay(1000);
        return;
    }
    //Serial.println("client connected sending packet");  
    if(Serial.available()>0){
        char c = Serial.read();
        if(c == 'a'){
            client.print("'a' is sent!");
        }else if(c == 'b'){
            client.print("'b' is sent!");
        }
        client.print(c);
    }
    //client.print("Hello from ESP32!");
    client.stop();    // 여기서 클라이언트를 끊음, 깔끔하게 만들어준다. 계속 연결되어 있으면 연결이 더러워진다.
    delay(100);
}
```

```python
import socket

print("Creating server...")
s = socket.socket()
s.bind(('0.0.0.0', 10000))
s.listen(0)

while True:
    client, addr = s.accept()
    while True:
        content = client.recv(6)
        if len(content) == 0:
            client.send("uga".encode())
            break
        else:
            print(content.decode())
    #print("Closing connection")
    client.close()

```

이번엔 문자열 출력

```arduino
#include <WiFi.h>

#define ssid  "ConnectValue_A401_2G"
#define password   "CVA401!@#$"

void setup() {
    Serial.begin(115200);
    WiFi.begin(ssid, password);               //Serial begine와 같다.
    while (WiFi.status() != WL_CONNECTED) {   // 연결 되지 않으면 '.'출력
        delay(500);
        Serial.println(".");
    }
    Serial.print("WiFi connected with IP:");  // 연결되면 While문에서 나옴, 그리고 IP번호를 받음
    Serial.println(WiFi.localIP());           // 자기가 wifi번호를 IP번호를 출력
}

void loop() {
    WiFiClient client;                                      // 이런 이름의 객체를 만
    if(!client.connect(IPAddress(172,30,1,51), 10000)){     // 여기에 ip주소를 넣으면됨          
    // if (!client.connect("192.168.1.68", 10000)) {          
        Serial.println("Connection to host failed");
        delay(1000);
        return;
    }
    //Serial.println("client connected sending packet");  
     String inputString = "";
    while (Serial.available() > 0) {
        char c = Serial.read();  // 시리얼 입력 읽기
        inputString += c;  // 문자열에 추가
        delay(10);  // 시리얼 데이터 읽기 대기 시간 (필요에 따라 조정)
    }

    if (inputString.length() > 0) {
        client.print("Sent: ");
        client.print(inputString);  // 문자열 전체를 한 번에 전송
        Serial.print("Sent: ");
        Serial.println(inputString);  // 전송된 데이터 확인용
    }
    //client.print("Hello from ESP32!");
    client.stop();    // 여기서 클라이언트를 끊음, 깔끔하게 만들어준다. 계속 끊어줌으로써 로봇을 만들때 통신을 훨신 깔끔하게 만들어줌
    delay(100);
}
```

```python
import socket

print("Creating server...")
s = socket.socket()
s.bind(('0.0.0.0', 10000))
s.listen(0)

while True:
    client, addr = s.accept()
    while True:
        content = client.recv(10)
        if len(content) == 0:
            client.send("uga".encode())
            break
        else:
            print(content.decode())
    #print("Closing connection")
    client.close()

```

# 웹소켓 통신

- 소켓 통신 http는 마치 방송 같은 것이다. 틀면 나온다.

- 웹소켓은 전화 통화 처럼 양쪽으로 통신이 가능하다.

사람입장에서는 http로 통신을 보내는 것이 쉽다. 그리고 TCP

http는 일방적으로 키고 볼 수 있는것

TCP는 전화 같은 것 키면 양방향으로도 통신이 가능한것

웹소켓은 방송을 키면 전화번호를 보여줘서 그곳으로 전화를 알 수 있는것
그때 부터는 소켓 통신을 할 수 있는 것이다.

웹소켓은 아두이노와 esp23을 같이 쓸 수 있다느 것이다.

지금 우리가 가지고 있는 코드는 esp와 아두이노가 같이 돌아가지 않지만 웹소켓이라는 라이브러리를 가능하다.

# 아두이노에서 와이파이에 접속하는 것은 3가지가 있다

1. 와이파이 쉴드 + 우노 을 갖고 tcp소켓으로 통신
2. esp23 를 갖고 tcp소텟으로 통신

이 두개는 TCP소켓으로 통신하여 연결하는 것이다.

1. 이것과 상관 없이 ycp소켓으로 통신이 가능하면 웹소켓은 http에 접근하여 와이파이와 연결하는 방식이기에 가능하다.

TCP 소켓은 인베디드에 매우 가까워 졌다. 그러므로 소프트웨어 적으로는 불친절하다.

그러나 웹소켓의 경우 매우 친절하다.

```arduino
//https://shawnhymel.com/1675/arduino-websocket-server-using-an-esp32/
//  websockets library by Markus Sattler
#include <WiFi.h>
#include <WebSocketsServer.h>
#define ssid  "ConnectValue_A401_2G"
#define password   "CVA401!@#$"

WebSocketsServer webSocket = WebSocketsServer(80);

// Called when receiving any WebSocket message
void onWebSocketEvent(uint8_t num, WStype_t type, uint8_t * payload, size_t length)
{

  // Figure out the type of WebSocket event
  switch(type) {

    // Client has disconnected
    case WStype_DISCONNECTED:
      Serial.printf("[%u] Disconnected!\n", num);
      break;

    // New client has connected
    case WStype_CONNECTED:
      {
        IPAddress ip = webSocket.remoteIP(num);
        Serial.printf("[%u] Connection from ", num);
        Serial.println(ip.toString());
      }
      break;

    // Echo text message back to client
    case WStype_TEXT:
      Serial.printf("[%u] Text: %s\n", num, payload);
      webSocket.sendTXT(num, payload);
      break;

    // For everything else: do nothing
    case WStype_BIN:
    case WStype_ERROR:
    case WStype_FRAGMENT_TEXT_START:
    case WStype_FRAGMENT_BIN_START:
    case WStype_FRAGMENT:
    case WStype_FRAGMENT_FIN:
    default:
      break;
  }
}

void setup() {
  // Start Serial port
  Serial.begin(115200);
  // Connect to access point
  Serial.println("Connecting");
  WiFi.begin(ssid, password);
  while ( WiFi.status() != WL_CONNECTED ) {
    delay(500);
    Serial.print(".");
  }
  // Print our IP address
  Serial.println("Connected!");
  Serial.print("My IP address: ");
  Serial.println(WiFi.localIP());
  // Start WebSocket server and assign callback
  webSocket.begin();
  webSocket.onEvent(onWebSocketEvent);
}

void loop() {

  // Look for and handle WebSocket data
  webSocket.loop();
}
```

```python
import websocket

# Connect to WebSocket server
ws = websocket.WebSocket()
ws.connect("ws://172.30.1.34")    # 파이썬에서는 이 IP주소가 끝이다.
print("Connected to WebSocket server")

# Ask the user for some input and transmit it
str = input("Say something: ")
ws.send(str)

# Wait for server to respond and print it
result = ws.recv()
print("Received: " + result)

# Gracefully close WebSocket connection
ws.close()
```

이게 웹 소켓 방식으로 훨씬 더 소프트웨어 적이다.

TCP를 잘하는 사람들은 웹소켓을 쓰는 사람들을 무시한다.

TCp가 훨신 구현하는데 어렵기 때문에 편하게 한 3줄만에 만드는 웹소켓을 무시한다

이니셜 D와 롤스로이스

TCP 와 websocket

# 로봇 센서

센서중에 가장 중요한 센서는 카메라 센서이다.

카메라 이미지로 할 수 있는 것이 정말 많아 진다

- 로봇센서는 주변의 물리적 자극을 전기적 신호로 변환하여 시스템에 전달하는 것이다.
- 로봇은 이 신호를 이용하여 위치, 방향, 속도, 주변 물체의 존재 및 특성 등을 파악하는 것이다.

# 센서의 종류

- 광센서 : 태양광
- 음향센서 : 마이크
- 접촉센서 : 그리퍼의 매질파악(로봇암에서 매우 중요)
- 근접 센서 : 거리는 힘들고 거의 유무만
- 적외선 센서 : 무접촉으로 유무 거리 파악
- 초음파 센서 : 적외선과 비슷
- 포토레지스터 : 빛의 양 측정
- 초음파 거리센서 :
- 적외선 거리센서 :
- 레이저 거리센서 :
- 엔코더 : 모터의 속도를 측정하는 것에 특화이기에 매우 많이 사용할 예정이다.
- 비전센서 :
- 스테에오카메라 :
- 압력센서 :
- 지자기 센서 :
- 자이로센서 :
- 가속도 센서 :
- IMU :
- 전류센서 :
- 전압센서 :
- 토크센서 :
- 라이다센서 :
- GPS :

이 뒤로는 openCv로 카메라 인식을 주로 보았다.

카메라로 차선인식

차선 인식

![Untitled](Untitled%2063.png)

AGV를 만들 사람들은 이 기술을 잘 기억해야함

뒤의 내용 책보고 정리